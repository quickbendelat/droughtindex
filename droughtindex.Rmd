---
title: "droughtindex"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rayshader)
library(ncdf4)

library(viridis)
library(raster)
```

open the file and extract data of longitude and latitude for raster
```{r}
nc_dat <- nc_open('20200323_NZDI.nc')
# Save the print(nc) dump to a text file
{
    sink('droughtindex_metadata.txt')
 print(nc_dat)
    sink()
}
lon <- ncvar_get(nc_dat, "lon")
lat <- ncvar_get(nc_dat, "lat")


```

extract the data as an array
```{r}
ndvi.array <- ncvar_get(nc_dat) 

nc_close(nc_dat) 


```


use raster and plot the rastered data
https://rpubs.com/boyerag/297592

assuming the coordinate reference system is the standard well-known text format, WGS84 system
```{r}
r <- raster(t(ndvi.array), xmn=min(lon), xmx=max(lon), ymn=min(lat), ymx=max(lat), crs=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0"))
plot(r)
```






convert the matrix array into a dataframe

```{r}
nc_df <- ndvi.array %>% reshape2::melt()
# nc_df <- ndvi.array %>% reshape2::melt() %>% na.omit


```


create a ggplot raster image
```{r}
gg_di = ggplot(nc_df, aes(Var2, Var1)) +
  geom_raster(aes(fill=value)) +
  scale_fill_gradient(low = "grey90", high = "red")
  
  # stat_density_2d(aes(fill = stat(value)), geom = "polygon", n = 100, bins = 10,contour = TRUE) +
  # scale_fill_viridis_c(option = "A")
```


use rayshader to generate a 3d plot
```{r}
plot_gg(gg_di,multicore=TRUE,width=5,height=5,scale=250,windowsize=c(1400,866),
        zoom = 0.55, phi = 30)
```

